(function(a,c){var b=a.EmbeddedChat=a.EmbeddedChat||{};a.CONFIG={MAX_CHAT_MSG_LENGTH:5000};_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,escape:/\{\{\{(.+?)\}\}\}/g};b.validateFieldLength=function(){var e=c(this),f=e.val(),d=e.attr("maxlength");if(f.length>d){e.val(f.substr(0,d))}};b.isPopup=function(){return false};b.isAttachmentFeatureEnabled=function(){var d=ChatConfig.features||{};return d.chatAttachments};b.getDefaultWindowSize=function(){return{width:parseInt(this.windowProperties.width,10),height:parseInt(this.windowProperties.height.open,10)}};b.getWindowChromeSize=function(){return{width:window.outerWidth-window.innerWidth,height:window.outerHeight-window.innerHeight}};b.getWindowInnerSize=function(){return{width:window.innerWidth,height:window.innerHeight}};b.resizeWindow=function(l,h){if(h&&this.windowProperties){var e=this.getDefaultWindowSize();var j=l.prop("scrollHeight")-l.height();var f=10;this.customWidth=e.width;this.customHeight=e.height+j+f;if(this.isPopup()){var k=this.getWindowChromeSize();var d=this.customWidth+k.width;var g=this.customHeight+k.height;window.resizeTo(d,g);window.setTimeout(_.bind(function(){var n=this.getWindowInnerSize();var m=this.customHeight-n.height;if(m>0){window.moveBy(0,-m);window.resizeTo(d,g)}window.setTimeout(_.bind(function(){this.customWidth=n.width;this.customHeight=n.height},this),0)},this),0)}else{var i=this.chatBrowserInfo.innerHeight;this.customHeight=this.customHeight>i?i:this.customHeight;this.sendMessage("chat:resize",{width:this.customWidth+"px",height:this.customHeight+"px"})}}};b.restorePopupSize=function(){var d=this.getDefaultWindowSize();var e=this.getWindowChromeSize();this.customWidth=d.width;this.customHeight=d.height;window.resizeTo(this.customWidth+e.width,this.customHeight+e.height)};b.canResize=function(e){var f=this.customWidth===undefined||this.customWidth==window.innerWidth;var d=this.customHeight===undefined||this.customHeight==window.innerHeight;return e&&(this.isPopup()?f&&d:true)};b.recalculateHeight=function(f){var e=c(".js-form-list:visible"),d=c(".js-message-history:visible");if(e.length){this.resizeWindow(e,this.canResize(f))}if(d.length){if(this.isPopup()&&this.canResize(f)){this.restorePopupSize()}}};b.resetScroll=function(){c(".js-form-list").animate({scrollTop:0},"fast")};b.showHideChatMenu=function(e,g,f){f.preventDefault&&f.preventDefault();var d=Math.floor(e.position().top)===0;e.animate({top:d?-(g.height()+1)+"px":0},300,"swing",function(){var h=e.position()&&Math.floor(e.position().top);d=h===0||h===-1;if(!d){g.css("visibility","hidden")}else{g.find(".action").first().focus()}});g.css("visibility","initial");if(b.i18n){f.target.setAttribute("title",d?b.i18n.t("pullDownInfo"):b.i18n.t("pullUpInfo"));f.target.setAttribute("aria-label",d?b.i18n.t("pullDownInfo"):b.i18n.t("pullUpInfo"))}};b.setupChatWindow=function(){var e=c(".js-message-actions");var f=e.find(".actions");var d=e.find(".js-flag");e.css("top",-(f.height()+1)+"px");f.css("visibility","hidden");d.click(this.showHideChatMenu.bind(this,e,f))};b.modernize=function(d){var e=d?c(d):c("body");if(!("maxLength" in document.createElement("textarea"))){e.find("textarea[maxlength]").on("keydown keyup focus blur",this.validateFieldLength)}}})(this,jQuery);